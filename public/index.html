<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö–ò–ù–û69 ‚Äî –ö–æ–º–Ω–∞—Ç–∞</title>
<link rel="stylesheet" href="/css/style.css">
<script src="/socket.io/socket.io.js"></script>
</head>
<body>

<h2>üé• –ö–æ–º–Ω–∞—Ç–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</h2>

<!-- üé¨ –ü–ª–µ–µ—Ä -->
<iframe
  id="player"
  width="800"
  height="450"
  frameborder="0"
  allowfullscreen>
</iframe>

<br><br>

<input id="videoLink" placeholder="YouTube / VK / Rutube / Vimeo / Dailymotion">
<button onclick="setVideo()">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>

<script>
const socket = io();
const room = new URLSearchParams(location.search).get("room");

socket.emit("join-room", room);

function setVideo() {
  const link = document.getElementById("videoLink").value.trim();
  let m;

  // ‚ñ∂ VK Video
  m = link.match(/video(-?\d+)_(\d+)/);
  if (m) {
    send(`https://vk.com/video_ext.php?oid=${m[1]}&id=${m[2]}`);
    return;
  }

  // ‚ñ∂ YouTube (youtube.com / youtu.be)
  m = link.match(/(?:v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
  if (m) {
    send(`https://www.youtube.com/embed/${m[1]}`);
    return;
  }

  // ‚ñ∂ Rutube
  m = link.match(/rutube\.ru\/video\/([a-zA-Z0-9]+)/);
  if (m) {
    send(`https://rutube.ru/play/embed/${m[1]}`);
    return;
  }

  // ‚ñ∂ Vimeo
  m = link.match(/vimeo\.com\/(\d+)/);
  if (m) {
    send(`https://player.vimeo.com/video/${m[1]}`);
    return;
  }

  // ‚ñ∂ Dailymotion
  m = link.match(/dailymotion\.com\/video\/([a-zA-Z0-9]+)/);
  if (m) {
    send(`https://www.dailymotion.com/embed/video/${m[1]}`);
    return;
  }

  alert("‚ùå –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è —Å—Å—ã–ª–∫–∞");
}

function send(src) {
  socket.emit("set-video", { room, src });
}

socket.on("set-video", data => {
  document.getElementById("player").src = data.src;
});
</script>

</body>
</html>
